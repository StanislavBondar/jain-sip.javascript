PrivateJainSipCallConnector=function(a,c,b){console.debug("PrivateJainSipCallConnector:PrivateJainSipCallConnector()");if(c instanceof WebRtcCommCall){if(typeof(b)=="string"){this.sipCallId=b}else{this.sipCallId=new String(new Date().getTime())}this.clientConnector=a;this.webRtcCommCall=c;this.webRtcCommCall.id=this.sipCallId;this.configuration=undefined;this.resetSipContext()}else{throw"PrivateJainSipCallConnector:PrivateJainSipCallConnector(): bad arguments"}};PrivateJainSipCallConnector.prototype.SIP_INVITING_INITIAL_STATE="INVITING_INITIAL_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_STATE="INVITING_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_407_STATE="INVITING_407_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_ACCEPTED_STATE="INVITING_ACCEPTED_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_LOCAL_HANGINGUP_STATE="INVITING_LOCAL_HANGINGUP_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_LOCAL_HANGINGUP_407_STATE="INVITING_LOCAL_HANGINGUP_407_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_CANCELLING_STATE="INVITING_CANCELLING_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_ERROR_STATE="INVITING_ERROR_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_HANGUP_STATE="INVITING_HANGUP_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITING_CANCELLED_STATE="SIP_INVITING_CANCELLED_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_INITIAL_STATE="INVITED_INITIAL_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_ACCEPTED_STATE="INVITED_ACCEPTED_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_LOCAL_HANGINGUP_STATE="INVITED_LOCAL_HANGINGUP_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_LOCAL_HANGINGUP_407_STATE="INVITED_LOCAL_HANGINGUP_407_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_HANGUP_STATE="INVITED_HANGUP_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_ERROR_STATE="INVITED_ERROR_STATE";PrivateJainSipCallConnector.prototype.SIP_INVITED_CANCELLED_STATE="INVITING_HANGUP_STATE";PrivateJainSipCallConnector.prototype.isOpened=function(){return((this.sipCallState==this.SIP_INVITING_ACCEPTED_STATE)||(this.sipCallState==this.SIP_INVITED_ACCEPTED_STATE))};PrivateJainSipCallConnector.prototype.getId=function(){return this.sipCallId};PrivateJainSipCallConnector.prototype.open=function(a){console.debug("PrivateJainSipCallConnector:open()");if(this.sipCallState==undefined){if(typeof(a)=="object"){if(this.checkConfiguration(a)==true){this.sipCallState=this.SIP_INVITING_INITIAL_STATE;this.configuration=a}else{console.error("PrivateJainSipCallConnector:open(): bad configuration");throw"PrivateJainSipCallConnector:open(): bad configuration"}}else{this.sipCallState=SIP_INVITED_INITIAL_STATE}}else{console.error("PrivateJainSipCallConnector:open(): bad state, unauthorized action");throw"PrivateJainSipCallConnector:open(): bad state, unauthorized action"}};PrivateJainSipCallConnector.prototype.close=function(){console.debug("PrivateJainSipCallConnector:close(): this.sipCallState="+this.sipCallState);if(this.sipCallState!=undefined){try{if(this.sipCallState==this.SIP_INITIAL_INVITING_STATE){this.resetSipContext();this.clientConnector.removeCallConnector(this.sipCallId);this.webRtcCommCall.onPrivateCallConnectorCallClosedEvent()}else{if(this.sipCallState==this.SIP_INVITING_STATE||this.sipCallState==this.SIP_INVITING_407_STATE){this.jainSipInvitingCancelRequest=this.jainSipInvitingTransaction.createCancel();this.jainSipInvitingCancelRequest.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitingCancelTransaction=this.clientConnector.jainSipProvider.getNewClientTransaction(this.jainSipInvitingCancelRequest);this.jainSipInvitingCancelTransaction.sendRequest();this.sipCallState=this.SIP_INVITING_CANCELLING_STATE}else{if(this.sipCallState==this.SIP_INVITING_ACCEPTED_STATE){var c=this.jainSipInvitingDialog.createRequest("BYE");c.removeHeader("Contact");c.removeHeader("User-Agent");c.addHeader(this.clientConnector.jainSipContactHeader);var a=this.clientConnector.jainSipProvider.getNewClientTransaction(c);this.jainSipInvitingDialog.sendRequest(a);this.sipCallState=this.SIP_INVITING_LOCAL_HANGINGUP_STATE;this.webRtcCommCall.onPrivateCallConnectorCallClosedEvent()}else{if(this.sipCallState==this.SIP_INVITED_INITIAL_STATE){var d=this.jainSipInvitedRequest.createResponse(480,"Temporarily Unavailable");d.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitedTransaction.sendResponse(d);this.resetSipContext();this.clientConnector.removeCallConnector(this.sipCallId)}else{if(this.sipCallState==this.SIP_INVITED_ACCEPTED_STATE){var c=this.jainSipInvitedDialog.createRequest("BYE");c.removeHeader("Contact");c.removeHeader("User-Agent");c.addHeader(this.clientConnector.jainSipContactHeader);var a=this.clientConnector.jainSipProvider.getNewClientTransaction(c);this.jainSipInvitedDialog.sendRequest(a);this.sipCallState=this.SIP_INVITED_LOCAL_HANGINGUP_STATE}else{this.resetSipContext();this.clientConnector.removeCallConnector(this.sipCallId);this.webRtcCommCall.onPrivateCallConnectorCallClosedEvent()}}}}}}catch(b){console.error("PrivateJainSipCallConnector:close(): catched exception:"+b);this.resetSipContext();this.clientConnector.removeCallConnector(this.sipCallId);this.webRtcCommCall.onPrivateCallConnectorCallClosedEvent()}}};PrivateJainSipCallConnector.prototype.reject=function(){console.debug("PrivateJainSipCallConnector:reject()");if(this.sipCallState==this.SIP_INVITED_INITIAL_STATE){try{var a=this.jainSipInvitedRequest.createResponse(486,"Busy here");a.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitedTransaction.sendResponse(a)}catch(b){console.error("PrivateJainSipCallConnector:reject(): catched exception:"+b)}this.close()}else{console.error("PrivateJainSipCallConnector:reject(): bad state, unauthorized action");throw"PrivateJainSipCallConnector:reject(): bad state, unauthorized action"}};PrivateJainSipCallConnector.prototype.checkConfiguration=function(b){console.debug("PrivateJainSipCallConnector:checkConfiguration()");var a=true;return a};PrivateJainSipCallConnector.prototype.resetSipContext=function(){console.debug("PrivateJainSipCallConnector:resetSipContext()");this.sipCallState=undefined;this.sdpOffer=undefined;this.jainSipAuthorizationHeader=undefined;this.jainSipInvitingSentRequest=undefined;this.jainSipInvitingDialog=undefined;this.jainSipInvitingTransaction=undefined;this.jainSipInvitedReceivedRequest=undefined;this.jainSipInvitedDialog=undefined;this.jainSipInvitedTransaction=undefined};PrivateJainSipCallConnector.prototype.invite=function(a){console.debug("PrivateJainSipCallConnector:invite()");this.sdpOffer=a;this.sendSipInviteRequest(a);this.sipCallState=this.SIP_INVITING_STATE};PrivateJainSipCallConnector.prototype.accept=function(a){console.debug("PrivateJainSipCallConnector:accept()");var b=this.jainSipInvitedRequest.createResponse(200,"OK");b.addHeader(this.clientConnector.jainSipContactHeader);b.setMessageContent("application","sdp",a);this.jainSipInvitedTransaction.sendResponse(b);this.sipCallState=this.SIP_INVITED_ACCEPTED_STATE};PrivateJainSipCallConnector.prototype.onJainSipClientConnectorSipRequestEvent=function(a){console.debug("PrivateJainSipCallConnector:onJainSipClientConnectorSipRequestEvent()");if(this.jainSipInvitingDialog!=undefined){this.processInvitingSipRequestEvent(a)}else{if(this.jainSipInvitedDialog!=undefined){this.processInvitedSipRequestEvent(a)}else{this.processInvitedSipRequestEvent(a)}}};PrivateJainSipCallConnector.prototype.onJainSipClientConnectorSipResponseEvent=function(a){console.debug("PrivateJainSipCallConnector:onJainSipClientConnectorSipResponseEvent()");if(this.jainSipInvitingDialog!=undefined){this.processInvitingSipResponseEvent(a)}else{if(this.jainSipInvitedDialog!=undefined){this.processInvitedSipResponseEvent(a)}else{console.warn("PrivateJainSipCallConnector:onJainSipClientConnectorSipResponseEvent(): response ignored")}}};PrivateJainSipCallConnector.prototype.onJainSipClientConnectorSipTimeoutEvent=function(a){console.debug("PrivateJainSipCallConnector:onJainSipClientConnectorSipTimeoutEvent()");this.close()};PrivateJainSipCallConnector.prototype.processInvitingSipRequestEvent=function(a){console.debug("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): this.sipCallState="+this.sipCallState);var c=a.getRequest();var d=c.getMethod();if(this.sipCallState==this.SIP_INVITING_INITIAL_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState==this.SIP_INVITING_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState==this.SIP_INVITING_407_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState==this.SIP_INVITING_FAILED_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState==this.SIP_INVITING_ACCEPTED_STATE){if(d=="BYE"){try{var e=c.createResponse(200,"OK");e.addHeader(this.clientConnector.jainSipContactHeader);a.getServerTransaction().sendResponse(e);this.sipCallState=this.SIP_INVITING_HANGUP_STATE}catch(b){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception exception:"+b)}this.webRtcCommCall.onPrivateCallConnectorCallHangupEvent();this.close()}else{console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}}else{console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): bad state, SIP request ignored")}}}}}};PrivateJainSipCallConnector.prototype.sendSipInviteRequest=function(){console.debug("PrivateJainSipCallConnector:sendSipInviteRequest()");var f=this.webRtcCommCall.getCalleePhoneNumber();if(f.indexOf("@")==-1){f+="@"+this.clientConnector.configuration.sipDomain}var a=this.clientConnector.configuration.sipUserName+"@"+this.clientConnector.configuration.sipDomain;var k=this.clientConnector.jainSipHeaderFactory.createCSeqHeader(1,"INVITE");var p=this.clientConnector.jainSipHeaderFactory.createCallIdHeader(this.sipCallId);var h=this.clientConnector.jainSipHeaderFactory.createMaxForwardsHeader(70);var d=this.clientConnector.jainSipAddressFactory.createSipURI_user_host(null,f);var j=this.clientConnector.jainSipHeaderFactory.createHeaders("Allow: INVITE,ACK,CANCEL,BYE");var b=this.clientConnector.jainSipAddressFactory.createSipURI_user_host(null,a);var g=this.clientConnector.jainSipAddressFactory.createAddress_name_uri(this.configuration.displayName,b);var n=new Date().getTime();var i=this.clientConnector.jainSipHeaderFactory.createFromHeader(g,n);var m=this.clientConnector.jainSipAddressFactory.createSipURI_user_host(null,f);var c=this.clientConnector.jainSipAddressFactory.createAddress_name_uri(null,m);var e=this.clientConnector.jainSipHeaderFactory.createToHeader(c,null);var l=this.clientConnector.jainSipListeningPoint.getViaHeader();var o=this.clientConnector.jainSipHeaderFactory.createContentTypeHeader("application","sdp");this.jainSipInvitingRequest=this.clientConnector.jainSipMessageFactory.createRequest(d,"INVITE",p,k,i,e,l,h,o,this.sdpOffer);this.clientConnector.jainSipMessageFactory.addHeader(this.jainSipInvitingRequest,j);this.clientConnector.jainSipMessageFactory.addHeader(this.jainSipInvitingRequest,this.clientConnector.jainSipContactHeader);if(this.jainSipAuthorizationHeader){this.clientConnector.jainSipMessageFactory.addHeader(this.jainSipInvitingRequest,this.jainSipAuthorizationHeader)}this.jainSipInvitingTransaction=this.clientConnector.jainSipProvider.getNewClientTransaction(this.jainSipInvitingRequest);this.jainSipInvitingRequest.setTransaction(this.jainSipInvitingTransaction);this.jainSipInvitingDialog=this.jainSipInvitingTransaction.getDialog();this.jainSipInvitingTransaction.sendRequest()};PrivateJainSipCallConnector.prototype.processInvitingSipResponseEvent=function(b){console.debug("PrivateJainSipCallConnector:processInvitingSipResponseEvent(): this.sipCallState="+this.sipCallState);var g=b.getResponse();var d=parseInt(g.getStatusCode());if(this.sipCallState==this.SIP_INVITING_STATE){if(d<200){if(d==180){this.webRtcCommCall.onPrivateCallConnectorCallRingingBackEvent()}else{if(d==183){this.webRtcCommCall.onPrivateCallConnectorCallInProgressEvent()}}console.debug("PrivateJainSipCallConnector:processInvitingSipResponseEvent(): 1XX response ignored")}else{if(d==407){this.jainSipAuthorizationHeader=this.clientConnector.jainSipHeaderFactory.createAuthorizationHeader(g,this.jainSipInvitingRequest,this.clientConnector.configuration.sipPassword,this.clientConnector.configuration.sipLogin);this.sendSipInviteRequest();this.sipCallState=this.SIP_INVITING_407_STATE}else{if(d==200){this.jainSipInvitingDialog=b.getOriginalTransaction().getDialog();try{this.jainSipInvitingDialog.setRemoteTarget(g.getHeader("Contact"));var e=this.jainSipInvitingTransaction.createAck();e.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitingDialog.sendAck(e);this.sipCallState=this.SIP_INVITING_ACCEPTED_STATE}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c)}try{var f=g.getContent();this.webRtcCommCall.onPrivateCallConnectorRemoteSdpAnswerEvent(f)}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c);this.webRtcCommCall.onPrivateCallConnectorCallOpenErrorEvent(c);this.close()}}else{console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): SIP INVITE failed:"+g.getStatusCode()+"  "+g.getStatusLine().toString());this.sipCallState=this.SIP_INVITING_ERROR_STATE;this.webRtcCommCall.onPrivateCallConnectorCallOpenErrorEvent(g.getStatusLine().getReasonPhrase());this.close()}}}}else{if(this.sipCallState==this.SIP_INVITING_CANCELLING_STATE){this.sipCallState=this.SIP_INVITING_CANCELLED_STATE;this.close()}else{if(this.sipCallState==this.SIP_INVITING_407_STATE){if(d<200){console.debug("PrivateJainSipCallConnector:processInvitingSipResponseEvent(): 1XX response ignored")}else{if(d==200){this.jainSipInvitingDialog=b.getOriginalTransaction().getDialog();try{this.jainSipInvitingDialog.setRemoteTarget(g.getHeader("Contact"));var e=this.jainSipInvitingTransaction.createAck();e.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitingDialog.sendAck(e);this.sipCallState=this.SIP_INVITING_ACCEPTED_STATE}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c)}try{var f=g.getContent();this.webRtcCommCall.onPrivateCallConnectorRemoteSdpAnswerEvent(f)}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c);this.webRtcCommCall.onPrivateCallConnectorCallOpenErrorEvent(c);this.close()}}else{this.sipCallState=this.SIP_INVITING_ERROR_STATE;this.webRtcCommCall.onPrivateCallConnectorCallOpenErrorEvent(g.getStatusLine().getReasonPhrase());this.close()}}}else{if(this.sipCallState==this.SIP_INVITING_FAILED_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipResponseEvent(): bad state, SIP response ignored")}else{if(this.sipCallState==this.SIP_INVITING_ACCEPTED_STATE){console.error("PrivateJainSipCallConnector:processInvitingSipResponseEvent(): bad state, SIP response ignored")}else{if(this.sipCallState==this.SIP_INVITING_LOCAL_HANGINGUP_STATE){if(d==407){try{var a=this.jainSipInvitingDialog.createRequest("BYE");var h=this.clientConnector.jainSipProvider.getNewClientTransaction(a);var i=this.clientConnector.jainSipHeaderFactory.createAuthorizationHeader(g,a,this.clientConnector.configuration.sipPassword,this.clientConnector.configuration.sipLogin);this.clientConnector.jainSipMessageFactory.addHeader(a,i);this.jainSipInvitingDialog.sendRequest(h);this.sipCallState=this.SIP_INVITING_HANGINGUP_407_STATE}catch(c){console.error("PrivateJainSipCallConnector:processInvitingSipRequestEvent(): catched exception, exception:"+c);this.close()}}else{this.close()}}else{if(this.sipCallState==this.SIP_INVITING_LOCAL_HANGINGUP_407_STATE){this.close()}else{console.error("PrivateJainSipCallConnector:processInvitingSipResponseEvent(): bad state, SIP response ignored")}}}}}}}};PrivateJainSipCallConnector.prototype.processInvitedSipRequestEvent=function(c){console.debug("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): this.sipCallState="+this.sipCallState);var a=c.getRequest();var e=a.getMethod();var d=a.getHeader("From");if(this.sipCallState==this.SIP_INVITED_INITIAL_STATE){if(e=="INVITE"){try{this.jainSipInvitedRequest=a;this.jainSipInvitedTransaction=c.getServerTransaction();this.jainSipInvitedDialog=c.getServerTransaction().getDialog();var j=a.createResponse(180,"Ringing");j.addHeader(this.clientConnector.jainSipContactHeader);c.getServerTransaction().sendResponse(j)}catch(b){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): catched exception, exception:"+b)}this.webRtcCommCall.onPrivateCallConnectorRemoteSdpOfferEvent(this.jainSipInvitedRequest.getContent());var f=this;var i=d.getAddress().getURI().getUser();this.webRtcCommCall.onPrivateCallConnectorCallRingingEvent(i)}else{if(e=="CANCEL"){try{var g=a.createResponse(200,"OK");g.addHeader(this.clientConnector.jainSipContactHeader);c.getServerTransaction().sendResponse(g);var h=this.jainSipInvitedRequest.createResponse(487,"(Request Cancelled)");this.jainSipInvitedTransaction.sendMessage(h);this.sipCallState=this.SIP_INVITED_CANCELLED_STATE}catch(b){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): catched exception, exception:"+b)}this.webRtcCommCall.onPrivateCallConnectorCallHangupEvent();this.close()}else{console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): bad state, SIP request ignored")}}}else{if(this.sipCallState==this.SIP_INVITED_ACCEPTED_STATE){if(e=="BYE"){try{var g=a.createResponse(200,"OK");g.addHeader(this.clientConnector.jainSipContactHeader);c.getServerTransaction().sendResponse(g);this.sipCallState=this.SIP_INVITED_HANGUP_STATE}catch(b){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): catched exception exception:"+b)}this.webRtcCommCall.onPrivateCallConnectorCallHangupEvent();this.close()}else{if(e=="ACK"){this.jainSipInvitedDialog=c.getServerTransaction().getDialog()}else{console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): bad state, SIP request ignored")}}}else{if(this.sipCallState==this.SIP_INVITED_LOCAL_HANGINGUP_STATE){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): bad state, SIP request ignored")}else{if(this.sipCallState==this.SIP_INVITED_LOCAL_HANGINGUP_407_STATE){console.error("PrivateJainSipCallConnector:processInvitedSipRequestEvent(): bad state, SIP request ignored")}}}}};PrivateJainSipCallConnector.prototype.processInvitedSipResponseEvent=function(f){console.debug("PrivateJainSipCallConnector:processInvitedSipResponseEvent(): this.invitingState="+this.invitingState);var g=f.getResponse();var e=parseInt(g.getStatusCode());if(this.sipCallState==this.SIP_INVITED_STATE){console.error("PrivateJainSipCallConnector:processInvitedSipResponseEvent(): bad state, SIP response ignored")}else{if(this.sipCallState==this.SIP_INVITED_ACCEPTED_STATE){console.error("PrivateJainSipCallConnector:processInvitedSipResponseEvent(): bad state, SIP response ignored")}else{if(this.sipCallState==this.SIP_INVITED_LOCAL_HANGINGUP_STATE){if(e==407){try{var d=this.jainSipInvitedDialog.createRequest("BYE");var a=this.jainSipProvider.getNewClientTransaction(d);var b=this.jainSipHeaderFactory.createAuthorizationHeader(g,d,this.configuration.sipPassword,this.configuration.sipLogin);this.jainSipMessageFactory.addHeader(d,b);d.addHeader(this.clientConnector.jainSipContactHeader);this.jainSipInvitedDialog.sendRequest(a);this.sipCallState=this.SIP_INVITED_HANGINGUP_407_STATE}catch(c){console.error("PrivateJainSipCallConnector:processInvitedSipResponseEvent(): catched exception, exception:"+c);this.close()}}else{this.close()}}else{if(this.sipCallState==this.SIP_INVITED_LOCAL_HANGINGUP_407_STATE){this.close()}else{console.error("PrivateJainSipCallConnector:processInvitedSipResponseEvent(): bad state, SIP request ignored")}}}}};PrivateJainSipClientConnector=function(a){console.debug("PrivateJainSipClientConnector:PrivateJainSipClientConnector()");if(a instanceof WebRtcCommClient){this.webRtcCommClient=a;this.reset()}else{throw"PrivateJainSipClientConnector:PrivateJainSipClientConnector(): bad arguments"}};PrivateJainSipClientConnector.prototype.SIP_ALLOW_HEADER="Allow: INVITE,ACK,CANCEL,BYE, OPTIONS";PrivateJainSipClientConnector.prototype.SIP_UNREGISTERED_STATE="SIP_UNREGISTERED_STATE";PrivateJainSipClientConnector.prototype.SIP_REGISTERING_STATE="SIP_REGISTERING_STATE";PrivateJainSipClientConnector.prototype.SIP_REGISTER_REFRESHING_STATE="SIP_REGISTER_REFRESHING_STATE";PrivateJainSipClientConnector.prototype.SIP_REGISTERING_401_STATE="SIP_REGISTERING_401_STATE";PrivateJainSipClientConnector.prototype.SIP_REGISTERED_STATE="SIP_REGISTERED_STATE";PrivateJainSipClientConnector.prototype.SIP_UNREGISTERING_401_STATE="SIP_UNREGISTERING_401_STATE";PrivateJainSipClientConnector.prototype.SIP_UNREGISTERING_STATE="SIP_UNREGISTERING_STATE";PrivateJainSipClientConnector.prototype.SIP_SESSION_EXPIRATION_TIMER=3600;PrivateJainSipClientConnector.prototype.isOpened=function(){return this.openedFlag};PrivateJainSipClientConnector.prototype.open=function(f){console.debug("PrivateJainSipClientConnector:open()");try{if(typeof(f)=="object"){if(this.openedFlag==false){if(this.checkConfiguration(f)==true){this.configuration=f;this.jainSipFactory=new SipFactory();this.jainSipStack=this.jainSipFactory.createSipStack(this.configuration.sipUserAgent);this.jainSipListeningPoint=this.jainSipStack.createListeningPoint(this.configuration.sipOutboundProxy);this.jainSipProvider=this.jainSipStack.createSipProvider(this.jainSipListeningPoint);this.jainSipProvider.addSipListener(this);this.jainSipHeaderFactory=this.jainSipFactory.createHeaderFactory();this.jainSipAddressFactory=this.jainSipFactory.createAddressFactory();this.jainSipMessageFactory=this.jainSipFactory.createMessageFactory();this.jainSipContactHeader=this.jainSipListeningPoint.createContactHeader(this.configuration.sipUserName);if(this.configuration.sipUserAgentCapabilities){this.jainSipContactHeader.setParameter(this.configuration.sipUserAgentCapabilities,null)}if(this.configuration.sipUriContactParameters){try{var e=this.jainSipContactHeader.getAddress().getURI();var d=this.configuration.sipUriContactParameters.split(";");for(var c=0;c<d.length;c++){var a=d[c].split("=");e.uriParms.set_nv(new NameValue(a[0],a[1]))}}catch(b){console.error("PrivateJainSipClientConnector:open(): catched exception:"+b)}}this.jainSipMessageFactory.setDefaultUserAgentHeader(this.jainSipHeaderFactory.createUserAgentHeader(this.jainSipStack.getUserAgent()));this.jainSipStack.start()}else{console.error("PrivateJainSipClientConnector:open(): bad configuration");throw"PrivateJainSipClientConnector:open(): bad configuration"}}else{console.error("PrivateJainSipClientConnector:open(): bad state, unauthorized action");throw"PrivateJainSipClientConnector:open(): bad state, unauthorized action"}}else{console.error("PrivateJainSipClientConnector:open(): bad argument, check API documentation");throw"PrivateJainSipClientConnector:open(): bad argument, check API documentation"}}catch(b){this.reset();console.error("PrivateJainSipClientConnector:open(): catched exception:"+b);throw b}};PrivateJainSipClientConnector.prototype.close=function(){console.debug("PrivateJainSipClientConnector:close()");try{if(this.openedFlag==true){for(var a in this.callConnectors){var c=this.findCallConnector(a);if(c.isOpened()){c.close()}}if(this.configuration.sipRegisterMode==true){if(this.sipRegisterState==this.SIP_REGISTERED_STATE){this.sipUnregisterPendingFlag=false;this.sipRegisterState=this.SIP_UNREGISTERING_STATE;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sendNewSipRegisterRequest(0)}else{this.sipUnregisterPendingFlag=true}}else{this.reset();this.webRtcCommClient.onPrivateClientConnectorClosedEvent()}}else{console.error("PrivateJainSipClientConnector:close(): bad state, unauthorized action");throw"PrivateJainSipClientConnector:close(): bad state, unauthorized action"}}catch(b){console.error("PrivateJainSipClientConnector:close(): catched exception:"+b);throw b}};PrivateJainSipClientConnector.prototype.createPrivateCallConnector=function(d,a){console.debug("PrivateJainSipClientConnector:createPrivateCallConnector()");try{if(d instanceof WebRtcCommCall){if(this.openedFlag==true){var c=new PrivateJainSipCallConnector(this,d,a);c.clientConnector=this;this.callConnectors[c.sipCallId]=c;return c}else{console.error("PrivateJainSipClientConnector:createPrivateCallConnector(): bad state, unauthorized action");throw"PrivateJainSipClientConnector:createPrivateCallConnector(): bad state, unauthorized action"}}else{console.error("PrivateJainSipClientConnector:createPrivateCallConnector(): bad argument, check API documentation");throw"PrivateJainSipClientConnector:createPrivateCallConnector(): bad argument, check API documentation"}}catch(b){console.error("PrivateJainSipClientConnector:createPrivateCallConnector(): catched exception:"+b);throw b}};PrivateJainSipClientConnector.prototype.findCallConnector=function(a){console.debug("PrivateJainSipClientConnector:findCallConnector(): sipCallId="+a);return this.callConnectors[a]};PrivateJainSipClientConnector.prototype.removeCallConnector=function(a){console.debug("PrivateJainSipClientConnector:removeCallConnector(): sipCallId="+a);delete this.callConnectors.sipCallId};PrivateJainSipClientConnector.prototype.reset=function(){console.debug("PrivateJainSipClientConnector:reset()");this.openedFlag=false;this.configuration=undefined;this.resetSipRegisterContext();this.callConnectors={}};PrivateJainSipClientConnector.prototype.resetSipRegisterContext=function(){console.debug("PrivateJainSipClientConnector:resetSipRegisterContext()");if(this.sipRegisterRefreshTimer!=undefined){clearTimeout(this.sipRegisterRefreshTimer)}this.sipRegisterState=this.SIP_UNREGISTERED_STATE;this.sipRegisterRefreshTimer=undefined;this.sipRegisterAuthenticatedFlag=false;this.jainSipRegisterRequest=undefined;this.jainSipRegisterTransaction=undefined;this.jainSipRegisterDialog=undefined;this.sipUnregisterPendingFlag=false};PrivateJainSipClientConnector.prototype.checkConfiguration=function(c){console.debug("PrivateJainSipClientConnector:checkConfiguration()");try{var a=true;if(c.sipUserAgent==undefined||c.sipUserAgent.length==0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipUserAgent")}if(c.sipOutboundProxy==undefined||c.sipOutboundProxy.length==0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipOutboundProxy")}if(c.sipDomain==undefined||c.sipDomain.length==0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipDomain")}if(c.sipUserName==undefined||c.sipUserName.length==0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipUserName")}if(c.sipRegisterMode==undefined||c.sipRegisterMode.length==0){a=false;console.error("PrivateJainSipClientConnector:checkConfiguration(): missing configuration parameter sipRegisterMode")}if(c.sipLogin!=undefined&&c.sipLogin==""){c.sipLogin=undefined}if(c.sipPassword!=undefined&&c.sipPassword==""){c.sipPassword=undefined}if(c.sipUserAgentCapabilities!=undefined&&c.sipUserAgentCapabilities==""){c.sipUserAgentCapabilities=undefined}console.debug("PrivateJainSipClientConnector:checkConfiguration(): configuration.sipUserAgent:"+c.sipUserAgent);console.debug("PrivateJainSipClientConnector:checkConfiguration(): configuration.sipUserAgentCapabilities:"+c.sipUserAgentCapabilities);console.debug("PrivateJainSipClientConnector:checkConfiguration(): configuration.sipOutboundProxy:"+c.sipOutboundProxy);console.debug("PrivateJainSipClientConnector:checkConfiguration(): configuration.sipDomain:"+c.sipDomain);console.debug("PrivateJainSipClientConnector:checkConfiguration(): configuration.sipUserName:"+c.sipUserName);console.debug("PrivateJainSipClientConnector:checkConfiguration(): configuration.sipLogin:"+c.sipLogin);console.debug("PrivateJainSipClientConnector:checkConfiguration(): configuration.sipPassword: "+c.sipPassword);console.debug("PrivateJainSipClientConnector:checkConfiguration(): configuration.sipRegisterMode:"+c.sipRegisterMode);return a}catch(b){console.error("PrivateJainSipClientConnector:checkConfiguration(): catched exception:"+b);return false}};PrivateJainSipClientConnector.prototype.processConnected=function(){console.debug("PrivateJainSipClientConnector:processConnected()");try{if(this.openedFlag==false){if(this.configuration.sipRegisterMode==true){this.resetSipRegisterContext();this.sendNewSipRegisterRequest(this.SIP_SESSION_EXPIRATION_TIMER);this.sipRegisterState=this.SIP_REGISTERING_STATE;return}else{this.openedFlag=true;this.webRtcCommClient.onPrivateClientConnectorOpenedEvent();return}}else{console.error("PrivateJainSipClientConnector:processConnected(): this.openedFlag==true !")}this.reset();this.webRtcCommClient.onPrivateClientConnectorOpenErrorEvent()}catch(a){this.reset();this.webRtcCommClient.onPrivateClientConnectorOpenErrorEvent();console.error("PrivateJainSipClientConnector:processConnected(): catched exception:"+a)}};PrivateJainSipClientConnector.prototype.sendNewSipRegisterRequest=function(m){console.debug("PrivateJainSipClientConnector:sendNewSipRegisterRequest()");var a=this.configuration.sipUserName+"@"+this.configuration.sipDomain;var k=this.jainSipHeaderFactory.createCSeqHeader(1,"REGISTER");var o=this.jainSipHeaderFactory.createCallIdHeader(new String(new Date().getTime()));var c=this.jainSipHeaderFactory.createExpiresHeader(m);var g=this.jainSipHeaderFactory.createMaxForwardsHeader(70);var d=this.jainSipAddressFactory.createSipURI_user_host(null,this.configuration.sipDomain);var j=this.jainSipHeaderFactory.createHeaders(PrivateJainSipClientConnector.prototype.SIP_ALLOW_HEADER);var b=this.jainSipAddressFactory.createSipURI_user_host(null,a);var h=this.jainSipAddressFactory.createAddress_name_uri(null,b);var e=new Date();var n=e.getTime();var i=this.jainSipHeaderFactory.createFromHeader(h,n);var f=this.jainSipHeaderFactory.createToHeader(h,null);var l=this.jainSipListeningPoint.getViaHeader();this.jainSipRegisterRequest=this.jainSipMessageFactory.createRequest(d,"REGISTER",o,k,i,f,l,g);this.jainSipMessageFactory.addHeader(this.jainSipRegisterRequest,c);this.jainSipMessageFactory.addHeader(this.jainSipRegisterRequest,j);this.jainSipMessageFactory.addHeader(this.jainSipRegisterRequest,this.jainSipContactHeader);this.jainSipRegisterTransaction=this.jainSipProvider.getNewClientTransaction(this.jainSipRegisterRequest);this.jainSipRegisterDialog=this.jainSipRegisterTransaction.getDialog();this.jainSipRegisterRequest.setTransaction(this.jainSipRegisterTransaction);this.jainSipRegisterTransaction.sendRequest()};PrivateJainSipClientConnector.prototype.sendAuthenticatedSipRegisterRequest=function(d){console.debug("PrivateJainSipClientConnector:sendAuthenticatedSipRegisterRequest()");this.jainSipRegisterRequest.removeHeader("Authorization");var a=new SIPRequest();a.setMethod(this.jainSipRegisterRequest.getMethod());a.setRequestURI(this.jainSipRegisterRequest.getRequestURI());var c=this.jainSipRegisterRequest.getHeaders();for(var e=0;e<c.length;e++){a.addHeader(c[e])}var b=new Number(this.jainSipRegisterRequest.getCSeq().getSeqNumber());a.getCSeq().setSeqNumber(b+1);a.setCallId(this.jainSipRegisterRequest.getCallId());a.setVia(this.jainSipListeningPoint.getViaHeader());a.setFrom(this.jainSipRegisterRequest.getFrom());a.setTo(this.jainSipRegisterRequest.getTo());a.setMaxForwards(this.jainSipRegisterRequest.getMaxForwards());this.jainSipRegisterRequest=a;this.jainSipMessageFactory.addHeader(this.jainSipRegisterRequest,d);this.jainSipRegisterTransaction=this.jainSipProvider.getNewClientTransaction(this.jainSipRegisterRequest);this.jainSipRegisterRequest.setTransaction(this.jainSipRegisterTransaction);this.jainSipRegisterTransaction.sendRequest()};PrivateJainSipClientConnector.prototype.processDisconnected=function(){console.debug("PrivateJainSipClientConnector:processDisconnected(): SIP connectivity has been lost");try{this.reset();this.webRtcCommClient.onPrivateClientConnectorClosedEvent()}catch(a){console.error("PrivateJainSipClientConnector:processDisconnected(): catched exception:"+a)}};PrivateJainSipClientConnector.prototype.processConnectionError=function(a){console.war("PrivateJainSipClientConnector:processConnectionError(): SIP connection has failed, error:"+a);try{this.reset();this.webRtcCommClient.onPrivateClientConnectorOpenErrorEvent()}catch(b){console.error("PrivateJainSipClientConnector:processConnectionError(): catched exception:"+b)}};PrivateJainSipClientConnector.prototype.processRequest=function(a){console.debug("PrivateJainSipClientConnector:processRequest()");try{var f=a.getRequest();var e=f.getMethod();if(e=="OPTIONS"){this.processSipOptionRequest(a)}else{var c=f.getCallId().getCallId();var g=this.findCallConnector(c);if(g){g.onJainSipClientConnectorSipRequestEvent(a)}else{if(e=="INVITE"){var b=new WebRtcCommCall(this.webRtcCommClient);b.incomingCallFlag=true;b.connector=this.createPrivateCallConnector(b,c);b.id=b.connector.getId();b.connector.sipCallState=PrivateJainSipCallConnector.prototype.SIP_INVITED_INITIAL_STATE;b.connector.onJainSipClientConnectorSipRequestEvent(a)}else{console.warn("PrivateJainSipClientConnector:processRequest(): SIP request ignored")}}}}catch(d){console.error("PrivateJainSipClientConnector:processRequest(): catched exception:"+d)}};PrivateJainSipClientConnector.prototype.processResponse=function(b){console.debug("PrivateJainSipClientConnector:processResponse()");try{var d=b.getResponse();if(d.getCSeq().getMethod()=="REGISTER"){this.processSipRegisterResponse(b)}else{var c=this.findCallConnector(d.getCallId().getCallId());if(c){c.onJainSipClientConnectorSipResponseEvent(b)}else{console.warn("PrivateJainSipClientConnector:processResponse(): PrivateJainSipCallConnector not found, SIP response ignored")}}}catch(a){console.error("PrivateJainSipClientConnector:processResponse(): catched exception:"+a)}};PrivateJainSipClientConnector.prototype.processTransactionTerminated=function(){console.debug("PrivateJainSipClientConnector:processTransactionTerminated()")};PrivateJainSipClientConnector.prototype.processDialogTerminated=function(){console.debug("PrivateJainSipClientConnector:processDialogTerminated()")};PrivateJainSipClientConnector.prototype.processIOException=function(a){console.error("PrivateJainSipClientConnector:processIOException(): exceptionEvent="+a.message)};PrivateJainSipClientConnector.prototype.processTimeout=function(a){console.debug("PrivateJainSipClientConnector:processTimeout():timeoutEvent="+a);try{var d=a.getClientTransaction();var b=d.getDialog().getCallId().getCallId();var e=this.findCallConnector(b,false);if(e){e.onJainSipClientConnectorSipTimeoutEvent(a)}else{if(this.jainSipRegisterRequest.getCallId().getCallId()==b){console.error("PrivateJainSipClientConnector:processTimeout(): SIP registration failed, request timeout, no response from SIP server");this.reset();this.webRtcCommClient.onPrivateClientConnectorOpenErrorEvent("Request Timeout")}else{console.warn("PrivateJainSipClientConnector:processTimeout(): no dialog found, SIP timeout ignored")}}}catch(c){console.error("PrivateJainSipClientConnector:processTimeout(): catched exception:"+c)}};PrivateJainSipClientConnector.prototype.onSipRegisterTimeout=function(){console.debug("PrivateJainSipClientConnector:onSipRegisterTimeout()");try{if(this.sipRegisterState==this.SIP_REGISTERED_STATE){this.sipRegisterRefreshTimer=undefined;this.sipRegisterState=this.SIP_REGISTER_REFRESHING_STATE;this.sendNewSipRegisterRequest(this.SIP_SESSION_EXPIRATION_TIMER)}else{console.warn("PrivateJainSipClientConnector:onSipRegisterTimeout(): SIP REGISTER refresh stopped")}}catch(a){console.error("PrivateJainSipClientConnector:onSipRegisterTimeout(): catched exception:"+a)}};PrivateJainSipClientConnector.prototype.processSipRegisterResponse=function(d){console.debug("PrivateJainSipClientConnector:processSipRegisterResponse(): this.sipRegisterState="+this.sipRegisterState);var e=d.getResponse();var b=parseInt(e.getStatusCode());if(this.sipRegisterState==this.SIP_UNREGISTERED_STATE){console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): bad state, SIP response ignored")}else{if((this.sipRegisterState==this.SIP_REGISTERING_STATE)||(this.sipRegisterState==this.SIP_REGISTER_REFRESHING_STATE)){if(b<200){console.debug("PrivateJainSipClientConnector:processSipRegisterResponse(): 1XX response ignored")}else{if(b==401){if(this.configuration.sipPassword!=undefined&&this.configuration.sipLogin!=undefined){this.sipRegisterState=this.SIP_REGISTERING_401_STATE;var a=this.jainSipHeaderFactory.createAuthorizationHeader(e,this.jainSipRegisterRequest,this.configuration.sipPassword,this.configuration.sipLogin);this.sendAuthenticatedSipRegisterRequest(a)}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP registration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRtcCommClient.onPrivateClientConnectorOpenErrorEvent()}}else{if(b==200){this.sipRegisterState=this.SIP_REGISTERED_STATE;if(this.openedFlag==false){this.openedFlag=true;this.webRtcCommClient.onPrivateClientConnectorOpenedEvent()}if(this.sipUnregisterPendingFlag==true){this.sipUnregisterPendingFlag=false;this.sipRegisterState=this.SIP_UNREGISTERING_STATE;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sendNewSipRegisterRequest(0)}else{var c=this;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sipRegisterRefreshTimer=setTimeout(function(){c.onSipRegisterTimeout()},40000)}}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP registration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRtcCommClient.onPrivateClientConnectorOpenErrorEvent()}}}}else{if(this.sipRegisterState==this.SIP_REGISTERING_401_STATE){if(b<200){}else{if(b==200){this.sipRegisterState=this.SIP_REGISTERED_STATE;if(this.openedFlag==false){console.debug("PrivateJainSipClientConnector:processSipRegisterResponse(): this.openedFlag=true");this.openedFlag=true;this.webRtcCommClient.onPrivateClientConnectorOpenedEvent()}if(this.sipUnregisterPendingFlag==true){this.sipUnregisterPendingFlag=false;this.sipRegisterState=this.SIP_UNREGISTERING_STATE;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sendNewSipRegisterRequest(0)}else{var c=this;if(this.sipRegisterRefreshTimer){clearTimeout(this.sipRegisterRefreshTimer)}this.sipRegisterRefreshTimer=setTimeout(function(){c.onSipRegisterTimeout()},40000)}}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP registration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRtcCommClient.onPrivateClientConnectorOpenErrorEvent()}}}else{if(this.sipRegisterState==this.SIP_REGISTERED_STATE){console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): bad state, SIP response ignored")}else{if(this.sipRegisterState==this.SIP_UNREGISTERING_STATE){if(b<200){}else{if(b==401){this.sipRegisterState=this.SIP_UNREGISTERING_401_STATE;a=this.jainSipHeaderFactory.createAuthorizationHeader(e,this.jainSipRegisterRequest,this.configuration.sipPassword,this.configuration.sipLogin);this.sendAuthenticatedSipRegisterRequest(a)}else{if(b==200){this.reset();this.webRtcCommClient.onPrivateClientConnectorClosedEvent()}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP unregistration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRtcCommClient.onPrivateClientConnectorClosedEvent()}}}}else{if(this.sipRegisterState==this.SIP_UNREGISTERING_401_STATE){if(b<200){}else{if(b==200){this.reset();this.webRtcCommClient.onPrivateClientConnectorClosedEvent()}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): SIP unregistration failed:"+e.getStatusCode()+"  "+e.getStatusLine());this.reset();this.webRtcCommClient.onPrivateClientConnectorClosedEvent()}}}else{if(this.sipRegisterState==this.SIP_UNREGISTERED_STATE){console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): bad state, SIP response ignored")}else{console.error("PrivateJainSipClientConnector:processSipRegisterResponse(): bad state, SIP response ignored")}}}}}}}};PrivateJainSipClientConnector.prototype.processSipOptionRequest=function(a){console.debug("PrivateJainSipClientConnector:processSipOptionRequest()");var b=a.getRequest();var c=b.createResponse(200,"OK");c.addHeader(this.jainSipContactHeader);c.removeHeader("P-Asserted-Identity");c.removeHeader("P-Charging-Vector");c.removeHeader("P-Charging-Function-Addresses");c.removeHeader("P-Called-Party-ID");a.getServerTransaction().sendResponse(c)};WebRtcCommCall=function(a){if(a instanceof WebRtcCommClient){console.debug("WebRtcCommCall:WebRtcCommCall()");this.id=undefined;this.webRtcCommClient=a;this.calleePhoneNumber=undefined;this.callerPhoneNumber=undefined;this.incomingCallFlag=false;this.configuration=undefined;this.connector=undefined;this.peerConnection=undefined;this.peerConnectionState=undefined;this.remoteMediaStream=undefined;this.remoteSdpOffer=undefined;this.messageChannel=undefined}else{throw"WebRtcCommCall:WebRtcCommCall(): bad arguments"}};WebRtcCommCall.prototype.codecNames={0:"PCMU",8:"PCMA"};WebRtcCommCall.prototype.isOpened=function(){if(this.connector){return this.connector.isOpened()}else{return false}};WebRtcCommCall.prototype.isIncoming=function(){if(this.isOpened()){return this.incomingCallFlag}else{console.error("WebRtcCommCall:isIncoming(): bad state, unauthorized action");throw"WebRtcCommCall:isIncoming(): bad state, unauthorized action"}};WebRtcCommCall.prototype.getId=function(){return this.id};WebRtcCommCall.prototype.getCallerPhoneNumber=function(){return this.callerPhoneNumber};WebRtcCommCall.prototype.getConfiguration=function(){return this.configuration};WebRtcCommCall.prototype.getCalleePhoneNumber=function(){return this.calleePhoneNumber};WebRtcCommCall.prototype.getRemoteMediaStream=function(){return this.remoteMediaStream};WebRtcCommCall.prototype.open=function(d,g){console.debug("WebRtcCommCall:open():calleePhoneNumber="+d);console.debug("WebRtcCommCall:open():configuration="+JSON.stringify(g));if(typeof(g)=="object"){if(this.webRtcCommClient.isOpened()){if(this.checkConfiguration(g)){if(this.isOpened()==false){try{this.calleePhoneNumber=d;this.configuration=g;this.connector.open(g);this.createRTCPeerConnection();this.peerConnection.addStream(this.configuration.localMediaStream);var b=this;var c={mandatory:{OfferToReceiveAudio:this.configuration.audioMediaFlag,OfferToReceiveVideo:this.configuration.videoMediaFlag}};if(this.configuration.messageMediaFlag){if(this.peerConnection.createDataChannel){try{this.messageChannel=this.peerConnection.createDataChannel("mymessageChannel",{reliable:false});console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.messageChannel.label="+this.messageChannel.label);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.messageChannel.reliable="+this.messageChannel.reliable);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.messageChannel.binaryType="+this.messageChannel.binaryType);var b=this;this.messageChannel.onopen=function(e){b.processRtcPeerConnectionMessageChannelOnOpen(e)};this.messageChannel.onclose=function(e){b.processRtcPeerConnectionMessageChannelOnClose(e)};this.messageChannel.onerror=function(e){b.processRtcPeerConnectionMessageChannelOnError(e)};this.messageChannel.onmessage=function(e){b.processRtcPeerConnectionMessageChannelOnMessage(e)}}catch(a){alert("DataChannel not supported")}}}if(window.webkitRTCPeerConnection){this.peerConnection.createOffer(function(e){b.processRtcPeerConnectionCreateOfferSuccess(e)},function(e){b.processRtcPeerConnectionCreateOfferError(e)},c)}else{if(window.mozRTCPeerConnection){this.peerConnection.createOffer(function(e){b.processRtcPeerConnectionCreateOfferSuccess(e)},function(e){b.processRtcPeerConnectionCreateOfferError(e)},c)}}console.debug("WebRtcCommCall:open():mediaContraints="+JSON.stringify(c))}catch(a){console.error("WebRtcCommCall:open(): catched exception:"+a);setTimeout(function(){try{b.webRtcCommClient.eventListener.onWebRtcCommCallOpenErrorEvent(b,e)}catch(e){console.error("WebRtcCommCall:onPrivateCallConnectorCallOpenErrorEvent(): catched exception in listener:"+e)}},1);try{this.close()}catch(f){}throw a}}else{console.error("WebRtcCommCall:open(): bad state, unauthorized action");throw"WebRtcCommCall:open(): bad state, unauthorized action"}}else{console.error("WebRtcCommCall:open(): bad configuration");throw"WebRtcCommCall:open(): bad configuration"}}else{console.error("WebRtcCommCall:open(): bad state, unauthorized action");throw"WebRtcCommCall:open(): bad state, unauthorized action"}}else{console.error("WebRtcCommCall:open(): bad argument, check API documentation");throw"WebRtcCommCall:open(): bad argument, check API documentation"}};WebRtcCommCall.prototype.close=function(){console.debug("WebRtcCommCall:close()");if(this.webRtcCommClient.isOpened()){try{if(this.connector){this.connector.close()}if(this.peerConnection&&this.peerConnection.signalingState!="closed"){if(this.messageChannel){this.messageChannel.close()}this.peerConnection.close();this.peerConnection=undefined;var b=this;setTimeout(function(){b.webRtcCommClient.eventListener.onWebRtcCommCallClosedEvent(b)},1)}}catch(a){console.error("WebRtcCommCall:open(): catched exception:"+a)}}else{console.error("WebRtcCommCall:close(): bad state, unauthorized action");throw"WebRtcCommCall:close(): bad state, unauthorized action"}};WebRtcCommCall.prototype.accept=function(f){console.debug("WebRtcCommCall:accept():configuration="+JSON.stringify(f));if(typeof(f)=="object"){if(this.webRtcCommClient.isOpened()){if(this.checkConfiguration(f)){this.configuration=f;if(this.isOpened()==false){try{this.createRTCPeerConnection();this.peerConnection.addStream(this.configuration.localMediaStream);var d=undefined;if(window.webkitRTCPeerConnection){d=new RTCSessionDescription({type:"offer",sdp:this.remoteSdpOffer})}else{if(window.mozRTCPeerConnection){d=new mozRTCSessionDescription({type:"offer",sdp:this.remoteSdpOffer})}}var b=this;this.peerConnectionState="offer-received";this.peerConnection.setRemoteDescription(d,function(){b.processRtcPeerConnectionSetRemoteDescriptionSuccess()},function(e){b.processRtcPeerConnectionSetRemoteDescriptionError(e)})}catch(a){console.error("WebRtcCommCall:accept(): catched exception:"+a);try{this.close()}catch(c){}throw a}}else{console.error("WebRtcCommCall:accept(): bad state, unauthorized action");throw"WebRtcCommCall:accept(): bad state, unauthorized action"}}else{console.error("WebRtcCommCall:accept(): bad configuration");throw"WebRtcCommCall:accept(): bad configuration"}}else{console.error("WebRtcCommCall:accept(): bad state, unauthorized action");throw"WebRtcCommCall:accept(): bad state, unauthorized action"}}else{console.error("WebRtcCommCall:accept(): bad argument, check API documentation");throw"WebRtcCommCall:accept(): bad argument, check API documentation"}};WebRtcCommCall.prototype.reject=function(){console.debug("WebRtcCommCall:reject()");if(this.webRtcCommClient.isOpened()){try{this.connector.reject()}catch(a){console.error("WebRtcCommCall:reject(): catched exception:"+a);try{this.close()}catch(b){}throw a}}else{console.error("WebRtcCommCall:reject(): bad state, unauthorized action");throw"WebRtcCommCall:reject(): bad state, unauthorized action"}};WebRtcCommCall.prototype.sendMessage=function(b){console.debug("WebRtcCommCall:sendMessage()");if(this.webRtcCommClient.isOpened()){if(this.isOpened()){if(this.messageChannel&&this.messageChannel.readyState=="open"){try{this.messageChannel.send(b)}catch(a){console.error("WebRtcCommCall:sendMessage(): catched exception:"+a);throw"WebRtcCommCall:sendMessage(): catched exception:"+a}}else{console.error("WebRtcCommCall:sendMessage(): bad state, unauthorized action");throw"WebRtcCommCall:sendMessage(): bad state, unauthorized action, messageChannel not opened"}}else{console.error("WebRtcCommCall:sendMessage(): bad state, unauthorized action");throw"WebRtcCommCall:sendMessage(): bad state, unauthorized action"}}else{console.error("WebRtcCommCall:sendMessage(): bad state, unauthorized action");throw"WebRtcCommCall:sendMessage(): bad state, unauthorized action"}};WebRtcCommCall.prototype.muteLocalAudioMediaStream=function(){console.debug("WebRtcCommCall:muteLocalAudioMediaStream()");if(this.configuration.localMediaStream&&this.configuration.localMediaStream.signalingState==this.configuration.localMediaStream.LIVE){var b=undefined;if(this.configuration.localMediaStream.audioTracks){b=this.configuration.localMediaStream.audioTracks}else{if(this.configuration.localMediaStream.getAudioTracks){b=this.configuration.localMediaStream.getAudioTracks()}}if(b){for(var a=0;a<b.length;a++){b[a].enabled=false}}else{console.error("WebRtcCommCall:muteLocalAudioMediaStream(): not implemented by navigator");throw"WebRtcCommCall:muteLocalAudioMediaStream(): not implemented by navigator"}}else{console.error("WebRtcCommCall:muteLocalAudioMediaStream(): bad state, unauthorized action");throw"WebRtcCommCall:muteLocalAudioMediaStream(): bad state, unauthorized action"}};WebRtcCommCall.prototype.unmuteLocalAudioMediaStream=function(){console.debug("WebRtcCommCall:unmuteLocalAudioMediaStream()");if(this.configuration.localMediaStream&&this.configuration.localMediaStream.signalingState==this.configuration.localMediaStream.LIVE){var b=undefined;if(this.configuration.localMediaStream.audioTracks){b=this.configuration.localMediaStream.audioTracks}else{if(this.configuration.localMediaStream.getAudioTracks){b=this.configuration.localMediaStream.getAudioTracks()}}if(b){for(var a=0;a<b.length;a++){b[a].enabled=true}}else{console.error("WebRtcCommCall:unmuteLocalAudioMediaStream(): not implemented by navigator");throw"WebRtcCommCall:unmuteLocalAudioMediaStream(): not implemented by navigator"}}else{console.error("WebRtcCommCall:unmuteLocalAudioMediaStream(): bad state, unauthorized action");throw"WebRtcCommCall:unmuteLocalAudioMediaStream(): bad state, unauthorized action"}};WebRtcCommCall.prototype.muteRemoteAudioMediaStream=function(){console.debug("WebRtcCommCall:muteRemoteAudioMediaStream()");if(this.remoteMediaStream&&this.remoteMediaStream.signalingState==this.remoteMediaStream.LIVE){var b=undefined;if(this.remoteMediaStream.audioTracks){b=this.remoteMediaStream.audioTracks}else{if(this.remoteMediaStream.getAudioTracks){b=this.remoteMediaStream.getAudioTracks()}}if(b){for(var a=0;a<b.length;a++){b[a].enabled=false}}else{console.error("WebRtcCommCall:muteRemoteAudioMediaStream(): not implemented by navigator");throw"WebRtcCommCall:muteRemoteAudioMediaStream(): not implemented by navigator"}}else{console.error("WebRtcCommCall:muteRemoteAudioMediaStream(): bad state, unauthorized action");throw"WebRtcCommCall:muteRemoteAudioMediaStream(): bad state, unauthorized action"}};WebRtcCommCall.prototype.unmuteRemoteAudioMediaStream=function(){console.debug("WebRtcCommCall:unmuteRemoteAudioMediaStream()");if(this.remoteMediaStream&&this.remoteMediaStream.signalingState==this.remoteMediaStream.LIVE){var b=undefined;if(this.remoteMediaStream.audioTracks){b=this.remoteMediaStream.audioTracks}else{if(this.remoteMediaStream.getAudioTracks){b=this.remoteMediaStream.getAudioTracks()}}if(b){for(var a=0;a<b.length;a++){b[a].enabled=true}}else{console.error("WebRtcCommCall:unmuteRemoteAudioMediaStream(): not implemented by navigator");throw"WebRtcCommCall:unmuteRemoteAudioMediaStream(): not implemented by navigator"}}else{console.error("WebRtcCommCall:unmuteRemoteAudioMediaStream(): bad state, unauthorized action");throw"WebRtcCommCall:unmuteRemoteAudioMediaStream(): bad state, unauthorized action"}};WebRtcCommCall.prototype.hideLocalVideoMediaStream=function(){console.debug("WebRtcCommCall:hideLocalVideoMediaStream()");if(this.configuration.localMediaStream&&this.configuration.localMediaStream.signalingState==this.configuration.localMediaStream.LIVE){var b=undefined;if(this.configuration.localMediaStream.videoTracks){b=this.configuration.localMediaStream.videoTracks}else{if(this.configuration.localMediaStream.getVideoTracks){b=this.configuration.localMediaStream.getVideoTracks()}}if(b){b.enabled=!b.enabled;for(var a=0;a<b.length;a++){b[a].enabled=false}}else{console.error("WebRtcCommCall:hideLocalVideoMediaStream(): not implemented by navigator");throw"WebRtcCommCall:hideLocalVideoMediaStream(): not implemented by navigator"}}else{console.error("WebRtcCommCall:hideLocalVideoMediaStream(): bad state, unauthorized action");throw"WebRtcCommCall:hideLocalVideoMediaStream(): bad state, unauthorized action"}};WebRtcCommCall.prototype.showLocalVideoMediaStream=function(){console.debug("WebRtcCommCall:showLocalVideoMediaStream()");if(this.configuration.localMediaStream&&this.configuration.localMediaStream.signalingState==this.configuration.localMediaStream.LIVE){var b=undefined;if(this.configuration.localMediaStream.videoTracks){b=this.configuration.localMediaStream.videoTracks}else{if(this.configuration.localMediaStream.getVideoTracks){b=this.configuration.localMediaStream.getVideoTracks()}}if(b){b.enabled=!b.enabled;for(var a=0;a<b.length;a++){b[a].enabled=true}}else{console.error("WebRtcCommCall:showLocalVideoMediaStream(): not implemented by navigator");throw"WebRtcCommCall:showLocalVideoMediaStream(): not implemented by navigator"}}else{console.error("WebRtcCommCall:showLocalVideoMediaStream(): bad state, unauthorized action");throw"WebRtcCommCall:showLocalVideoMediaStream(): bad state, unauthorized action"}};WebRtcCommCall.prototype.hideRemoteVideoMediaStream=function(){console.debug("WebRtcCommCall:hideRemoteVideoMediaStream()");if(this.remoteMediaStream&&this.remoteMediaStream.signalingState==this.remoteMediaStream.LIVE){var b=undefined;if(this.remoteMediaStream.videoTracks){b=this.remoteMediaStream.videoTracks}else{if(this.remoteMediaStream.getVideoTracks){b=this.remoteMediaStream.getVideoTracks()}}if(b){b.enabled=!b.enabled;for(var a=0;a<b.length;a++){b[a].enabled=false}}else{console.error("WebRtcCommCall:hideRemoteVideoMediaStream(): not implemented by navigator");throw"WebRtcCommCall:hideRemoteVideoMediaStream(): not implemented by navigator"}}else{console.error("WebRtcCommCall:hideRemoteVideoMediaStream(): bad state, unauthorized action");throw"WebRtcCommCall:hideRemoteVideoMediaStream(): bad state, unauthorized action"}};WebRtcCommCall.prototype.showRemoteVideoMediaStream=function(){console.debug("WebRtcCommCall:showRemoteVideoMediaStream()");if(this.remoteMediaStream&&this.remoteMediaStream.signalingState==this.remoteMediaStream.LIVE){var b=undefined;if(this.remoteMediaStream.videoTracks){b=this.remoteMediaStream.videoTracks}else{if(this.remoteMediaStream.getVideoTracks){b=this.remoteMediaStream.getVideoTracks()}}if(b){b.enabled=!b.enabled;for(var a=0;a<b.length;a++){b[a].enabled=true}}else{console.error("WebRtcCommCall:showRemoteVideoMediaStream(): not implemented by navigator");throw"WebRtcCommCall:showRemoteVideoMediaStream(): not implemented by navigator"}}else{console.error("WebRtcCommCall:showRemoteVideoMediaStream(): bad state, unauthorized action");throw"WebRtcCommCall:showRemoteVideoMediaStream(): bad state, unauthorized action"}};WebRtcCommCall.prototype.checkConfiguration=function(b){console.debug("WebRtcCommCall:checkConfiguration()");var a=true;if(b.localMediaStream==undefined){a=false;console.error("WebRtcCommCall:checkConfiguration(): missing localMediaStream")}if(b.audioMediaFlag==undefined||(typeof(b.audioMediaFlag)!="boolean")){a=false;console.error("WebRtcCommCall:checkConfiguration(): missing audio media flag")}if(b.videoMediaFlag==undefined||(typeof(b.videoMediaFlag)!="boolean")){a=false;console.error("WebRtcCommCall:checkConfiguration(): missing video media flag")}if(b.messageMediaFlag==undefined||(typeof(b.messageMediaFlag)!="boolean")){a=false;console.error("WebRtcCommCall:checkConfiguration(): missing message media flag")}return a};WebRtcCommCall.prototype.createRTCPeerConnection=function(){console.debug("WebRtcCommCall:createPeerConnection()");var a={iceServers:[]};this.peerConnectionState="new";var b=this;if(this.webRtcCommClient.configuration.RTCPeerConnection.stunServer){a={iceServers:[{url:"stun:"+this.webRtcCommClient.configuration.RTCPeerConnection.stunServer}]}}var c={optional:[{RtpDataChannels:true}]};if(window.webkitRTCPeerConnection){this.peerConnection=new window.webkitRTCPeerConnection(a,c)}else{if(window.mozRTCPeerConnection){this.peerConnection=new window.mozRTCPeerConnection(a,c)}}this.peerConnection.onaddstream=function(d){b.processRtcPeerConnectionOnAddStream(d)};this.peerConnection.onremovestream=function(d){b.onRtcPeerConnectionOnRemoveStreamEvent(d)};this.peerConnection.onstatechange=function(d){b.onRtcPeerConnectionStateChangeEvent(d)};this.peerConnection.onicecandidate=function(d){b.onRtcPeerConnectionIceCandidateEvent(d)};this.peerConnection.ongatheringchange=function(d){b.onRtcPeerConnectionGatheringChangeEvent(d)};this.peerConnection.onicechange=function(d){b.onRtcPeerConnectionIceChangeEvent(d)};this.peerConnection.onopen=function(d){b.onRtcPeerConnectionOnOpenEvent(d)};this.peerConnection.onidentityresult=function(d){b.onRtcPeerConnectionIdentityResultEvent(d)};this.peerConnection.onnegotiationneeded=function(d){b.onRtcPeerConnectionIceNegotiationNeededEvent(d)};this.peerConnection.ondatachannel=function(d){b.onRtcPeerConnectionOnMessageChannelEvent(d)};console.debug("WebRtcCommCall:createPeerConnection(): this.peerConnection="+JSON.stringify(this.peerConnection))};WebRtcCommCall.prototype.onPrivateCallConnectorRemoteSdpOfferEvent=function(a){console.debug("WebRtcCommCall:onPrivateCallConnectorSdpOfferEvent()");this.remoteSdpOffer=a};WebRtcCommCall.prototype.onPrivateCallConnectorRemoteSdpAnswerEvent=function(d){console.debug("WebRtcCommCall:onPrivateCallConnectorRemoteSdpAnswerEvent()");try{var c=undefined;if(window.webkitRTCPeerConnection){c=new RTCSessionDescription({type:"answer",sdp:d})}else{if(window.mozRTCPeerConnection){c=new mozRTCSessionDescription({type:"answer",sdp:d})}}var b=this;this.peerConnectionState="answer-received";this.peerConnection.setRemoteDescription(c,function(){b.processRtcPeerConnectionSetRemoteDescriptionSuccess()},function(e){b.processRtcPeerConnectionSetRemoteDescriptionError(e)})}catch(a){console.error("WebRtcCommCall:onPrivateCallConnectorRemoteSdpAnswerEvent(): catched exception:"+a);throw a}};WebRtcCommCall.prototype.onPrivateCallConnectorCallOpenedEvent=function(){console.debug("WebRtcCommCall:onPrivateCallConnectorCallOpenedEvent()");if(this.webRtcCommClient.eventListener.onWebRtcCommCallOpenEvent){var a=this;setTimeout(function(){try{a.webRtcCommClient.eventListener.onWebRtcCommCallOpenEvent(a)}catch(b){console.error("WebRtcCommCall:onPrivateCallConnectorCallOpenedEvent(): catched exception in listener:"+b)}},1)}};WebRtcCommCall.prototype.onPrivateCallConnectorCallInProgressEvent=function(){console.debug("WebRtcCommCall:onPrivateCallConnectorCallOpenedEvent()");if(this.webRtcCommClient.eventListener.onWebRtcCommCallInProgressEvent){var a=this;setTimeout(function(){try{a.webRtcCommClient.eventListener.onWebRtcCommCallInProgressEvent(a)}catch(b){console.error("WebRtcCommCall:onPrivateCallConnectorCallOpenedEvent(): catched exception in listener:"+b)}},1)}};WebRtcCommCall.prototype.onPrivateCallConnectorCallOpenErrorEvent=function(a){console.debug("WebRtcCommCall:onPrivateCallConnectorCallOpenErrorEvent():error="+a);if(this.webRtcCommClient.eventListener.onWebRtcCommCallOpenErrorEvent){var b=this;setTimeout(function(){try{b.webRtcCommClient.eventListener.onWebRtcCommCallOpenErrorEvent(b,a)}catch(c){console.error("WebRtcCommCall:onPrivateCallConnectorCallOpenErrorEvent(): catched exception in listener:"+c)}},1)}};WebRtcCommCall.prototype.onPrivateCallConnectorCallRingingEvent=function(a){console.debug("WebRtcCommCall:onPrivateCallConnectorCallRingingEvent():callerPhoneNumber="+a);if(this.webRtcCommClient.eventListener.onWebRtcCommCallRingingEvent){this.callerPhoneNumber=a;var b=this;setTimeout(function(){try{b.webRtcCommClient.eventListener.onWebRtcCommCallRingingEvent(b)}catch(c){console.error("WebRtcCommCall:onPrivateCallConnectorCallOpenErrorEvent(): catched exception in listener:"+c)}},1)}};WebRtcCommCall.prototype.onPrivateCallConnectorCallRingingBackEvent=function(){console.debug("WebRtcCommCall:onPrivateCallConnectorCallRingingBackEvent()");if(this.webRtcCommClient.eventListener.onWebRtcCommCallRingingBackEvent){var a=this;setTimeout(function(){try{a.webRtcCommClient.eventListener.onWebRtcCommCallRingingBackEvent(a)}catch(b){console.error("WebRtcCommCall:onPrivateCallConnectorCallOpenErrorEvent(): catched exception in listener:"+b)}},1)}};WebRtcCommCall.prototype.onPrivateCallConnectorCallClosedEvent=function(){console.debug("WebRtcCommCall:onPrivateCallConnectorCallClosedEvent()");this.connector=undefined;try{this.close()}catch(a){}};WebRtcCommCall.prototype.onPrivateCallConnectorCallHangupEvent=function(){console.debug("WebRtcCommCall:onPrivateCallConnectorCallHangupEvent()");if(this.webRtcCommClient.eventListener.onWebRtcCommCallHangupEvent){var a=this;setTimeout(function(){try{a.webRtcCommClient.eventListener.onWebRtcCommCallHangupEvent(a)}catch(b){console.error("WebRtcCommCall:onPrivateCallConnectorCallHangupEvent(): catched exception in listener:"+b)}},1)}};WebRtcCommCall.prototype.processRtcPeerConnectionError=function(a){console.debug("WebRtcCommCall:processRtcPeerConnectionError(): error="+a);if(this.webRtcCommClient.eventListener.onWebRtcCommCallOpenErrorEvent){var c=this;setTimeout(function(){try{c.webRtcCommClient.eventListener.onWebRtcCommCallOpenErrorEvent(c,a)}catch(d){console.error("WebRtcCommCall:processRtcPeerConnectionError(): catched exception in listener:"+d)}},1)}try{this.close()}catch(b){}};WebRtcCommCall.prototype.processRtcPeerConnectionOnAddStream=function(b){try{console.debug("WebRtcCommCall:processRtcPeerConnectionOnAddStream(): event="+b);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionOnAddStream(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnAddStream(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnAddStream(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnAddStream(): this.peerConnectionState="+this.peerConnectionState);this.remoteMediaStream=b.stream}else{console.warn("WebRtcCommCall:processRtcPeerConnectionOnAddStream(): event ignored")}}catch(a){console.error("WebRtcCommCall:processRtcPeerConnectionOnAddStream(): catched exception, exception:"+a);this.processRtcPeerConnectionError()}};WebRtcCommCall.prototype.onRtcPeerConnectionOnRemoveStreamEvent=function(b){try{console.debug("WebRtcCommCall:onRtcPeerConnectionOnRemoveStreamEvent(): event="+b);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionOnRemoveStream(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnRemoveStream(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnRemoveStream(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnRemoveStream(): this.peerConnectionState="+this.peerConnectionState);this.remoteMediaStream=undefined}else{console.warn("WebRtcCommCall:processRtcPeerConnectionOnRemoveStream(): event ignored")}}catch(a){console.error("WebRtcCommCall:processRtcPeerConnectionOnRemoveStream(): catched exception, exception:"+a);this.processRtcPeerConnectionError()}};WebRtcCommCall.prototype.onRtcPeerConnectionIceCandidateEvent=function(c){try{console.debug("WebRtcCommCall:processRtcPeerConnectionIceCandidate(): rtcIceCandidateEvent="+JSON.stringify(c.candidate));if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionIceCandidate(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionIceCandidate(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionIceCandidate(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionIceCandidate(): this.peerConnectionState="+this.peerConnectionState);if(this.peerConnection.signalingState!="closed"){if(this.peerConnection.iceGatheringState=="complete"){if(window.webkitRTCPeerConnection){if(this.peerConnectionState=="preparing-offer"){this.connector.invite(this.peerConnection.localDescription.sdp);this.peerConnectionState="offer-sent"}else{if(this.peerConnectionState=="preparing-answer"){this.connector.accept(this.peerConnection.localDescription.sdp);this.peerConnectionState="established";if(this.webRtcCommClient.eventListener.onWebRtcCommCallOpenedEvent){var b=this;setTimeout(function(){try{b.webRtcCommClient.eventListener.onWebRtcCommCallOpenedEvent(b)}catch(d){console.error("WebRtcCommCall:processInvitingSipRequest(): catched exception in listener:"+d)}},1)}}else{if(this.peerConnectionState=="established"){}else{console.error("WebRtcCommCall:processRtcPeerConnectionIceCandidate(): RTCPeerConnection bad state!")}}}}}}else{console.error("WebRtcCommCall:processRtcPeerConnectionIceCandidate(): RTCPeerConnection closed!")}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionIceCandidate(): event ignored")}}catch(a){console.error("WebRtcCommCall:processRtcPeerConnectionIceCandidate(): catched exception, exception:"+a);this.processRtcPeerConnectionError(a)}};WebRtcCommCall.prototype.processRtcPeerConnectionCreateOfferSuccess=function(f){try{console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): sdpOffer="+JSON.stringify(f));if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): this.peerConnectionState="+this.peerConnectionState);if(this.peerConnectionState=="new"){var d=this;this.peerConnectionState="preparing-offer";var b=f.sdp;var e=new SDPParser();var a=e.parse(b);if(this.configuration.videoMediaFlag==false){this.removeMediaDescription(a,"video");f.sdp=a}if(this.configuration.audioMediaFlag==false){this.removeMediaDescription(a,"audio");f.sdp=a}if(this.configuration.audioCodecsFilter||this.configuration.videoCodecsFilter){try{this.applyConfiguredCodecFilterOnSessionDescription(a,this.configuration.audioCodecsFilter);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): parsedSdpOffer="+a);f.sdp=a}catch(c){console.error("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): configured codec filtering has failded, use inital RTCPeerConnection SDP offer")}}this.peerConnectionLocalDescription=f;this.peerConnection.setLocalDescription(f,function(){d.processRtcPeerConnectionSetLocalDescriptionSuccess()},function(g){d.processRtcPeerConnectionSetLocalDescriptionError(g)})}else{console.error("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): RTCPeerConnection bad state!")}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): event ignored")}}catch(c){console.error("WebRtcCommCall:processRtcPeerConnectionCreateOfferSuccess(): catched exception, exception:"+c);this.processRtcPeerConnectionError()}};WebRtcCommCall.prototype.processRtcPeerConnectionCreateOfferError=function(a){try{console.error("WebRtcCommCall:processRtcPeerConnectionCreateOfferError():error="+JSON.stringify(a));if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferError(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferError(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferError(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateOfferError(): this.peerConnectionState="+this.peerConnectionState);throw"WebRtcCommCall:processRtcPeerConnectionCreateOfferError():error="+a}else{console.warn("WebRtcCommCall:processRtcPeerConnectionCreateOfferError(): event ignored")}}catch(b){console.error("WebRtcCommCall:processRtcPeerConnectionCreateOfferError(): catched exception, exception:"+b);this.processRtcPeerConnectionError()}};WebRtcCommCall.prototype.processRtcPeerConnectionSetLocalDescriptionSuccess=function(){try{console.debug("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionSuccess()");if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionSuccess(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionSuccess(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionSuccess(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionSuccess(): this.peerConnectionState="+this.peerConnectionState);if(window.mozRTCPeerConnection){if(this.peerConnectionState=="preparing-offer"){this.connector.invite(this.peerConnection.localDescription.sdp);this.peerConnectionState="offer-sent"}else{if(this.peerConnectionState=="preparing-answer"){this.connector.accept(this.peerConnection.localDescription.sdp);this.peerConnectionState="established";if(this.webRtcCommClient.eventListener.onWebRtcCommCallOpenedEvent){var b=this;setTimeout(function(){try{b.webRtcCommClient.eventListener.onWebRtcCommCallOpenedEvent(b)}catch(c){console.error("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionSuccess(): catched exception in listener:"+c)}},1)}}else{if(this.peerConnectionState=="established"){}else{console.error("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionSuccess(): RTCPeerConnection bad state!")}}}}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionSuccess(): event ignored")}}catch(a){console.error("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionSuccess(): catched exception, exception:"+a);this.processRtcPeerConnectionError()}};WebRtcCommCall.prototype.processRtcPeerConnectionSetLocalDescriptionError=function(a){try{console.error("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionError():error="+JSON.stringify(a));if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionError(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionError(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionError(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionError(): this.peerConnectionState="+this.peerConnectionState);throw"WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionError():error="+a}else{console.warn("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionError(): event ignored")}}catch(b){console.error("WebRtcCommCall:processRtcPeerConnectionSetLocalDescriptionError(): catched exception, exception:"+b);this.processRtcPeerConnectionError()}};WebRtcCommCall.prototype.processRtcPeerConnectionCreateAnswerSuccess=function(c){try{console.debug("WebRtcCommCall:processRtcPeerConnectionCreateAnswerSuccess():answer="+JSON.stringify(c));if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionCreateAnswerSuccess(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateAnswerSuccess(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateAnswerSuccess(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateAnswerSuccess(): this.peerConnectionState="+this.peerConnectionState);if(this.peerConnectionState=="offer-received"){var b=this;this.peerConnectionState="preparing-answer";this.peerConnectionLocalDescription=c;this.peerConnection.setLocalDescription(c,function(){b.processRtcPeerConnectionSetLocalDescriptionSuccess()},function(d){b.processRtcPeerConnectionSetLocalDescriptionError(d)})}else{console.error("WebRtcCommCall:processRtcPeerConnectionCreateAnswerSuccess(): RTCPeerConnection bad state!")}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionCreateAnswerSuccess(): event ignored")}}catch(a){console.error("WebRtcCommCall:processRtcPeerConnectionCreateAnswerSuccess(): catched exception, exception:"+a);this.processRtcPeerConnectionError()}};WebRtcCommCall.prototype.processRtcPeerConnectionCreateAnswerError=function(a){console.error("WebRtcCommCall:processRtcPeerConnectionCreateAnswerError():error="+JSON.stringify(a));try{if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionCreateAnswerError(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateAnswerError(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateAnswerError(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionCreateAnswerError(): this.peerConnectionState="+this.peerConnectionState)}else{console.warn("WebRtcCommCall:processRtcPeerConnectionCreateAnswerError(): event ignored")}}catch(b){console.error("WebRtcCommCall:processRtcPeerConnectionCreateAnswerError(): catched exception, exception:"+b);this.processRtcPeerConnectionError()}};WebRtcCommCall.prototype.processRtcPeerConnectionSetRemoteDescriptionSuccess=function(){try{console.debug("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionSuccess()");if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionSuccess(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionSuccess(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionSuccess(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionSuccess(): this.peerConnectionState="+this.peerConnectionState);if(this.peerConnectionState=="answer-received"){this.peerConnectionState="established";if(this.webRtcCommClient.eventListener.onWebRtcCommCallOpenedEvent){var b=this;setTimeout(function(){try{b.webRtcCommClient.eventListener.onWebRtcCommCallOpenedEvent(b)}catch(d){console.error("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionSuccess(): catched exception in listener:"+d)}},1)}}else{if(this.peerConnectionState=="offer-received"){var b=this;var c={mandatory:{OfferToReceiveAudio:this.configuration.audioMediaFlag,OfferToReceiveVideo:this.configuration.videoMediaFlag}};if(window.webkitRTCPeerConnection){this.peerConnection.createAnswer(function(d){b.processRtcPeerConnectionCreateAnswerSuccess(d)},function(d){b.processRtcPeerConnectionCreateAnswerError(d)},c)}else{if(window.mozRTCPeerConnection){this.peerConnection.createAnswer(function(d){b.processRtcPeerConnectionCreateAnswerSuccess(d)},function(d){b.processRtcPeerConnectionCreateAnswerError(d)},{mandatory:{MozDontOffermessageChannel:true}})}}}else{console.error("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionSuccess(): RTCPeerConnection bad state!")}}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionSuccess(): event ignored")}}catch(a){console.error("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionSuccess(): catched exception, exception:"+a);this.processRtcPeerConnectionError()}};WebRtcCommCall.prototype.processRtcPeerConnectionSetRemoteDescriptionError=function(a){try{console.error("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionError():error="+JSON.stringify(a));if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionError(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionError(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionError(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionError(): this.peerConnectionState="+this.peerConnectionState);throw"WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionError():error="+a}else{console.warn("WebRtcCommCall:processRtcPeerConnectionSetRemoteDescriptionError(): event ignored")}}catch(b){this.processRtcPeerConnectionError(a)}};WebRtcCommCall.prototype.onRtcPeerConnectionOnOpenEvent=function(a){console.debug("WebRtcCommCall:processRtcPeerConnectionOnOpen(): event="+a);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionOnOpen(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnOpen(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnOpen(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnOpen(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionOnOpen(): this.peerConnectionState="+this.peerConnectionState)}else{console.warn("WebRtcCommCall:processRtcPeerConnectionOnOpen(): event ignored")}};WebRtcCommCall.prototype.onRtcPeerConnectionStateChangeEvent=function(a){console.debug("WebRtcCommCall:onRtcPeerConnectionStateChangeEvent(): event="+a);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionStateChange(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionStateChange(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionStateChange(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionStateChange(): this.peerConnectionState="+this.peerConnectionState);if(this.peerConnection&&this.peerConnection.signalingState=="closed"){this.peerConnection=null}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionStateChange(): event ignored")}};WebRtcCommCall.prototype.onRtcPeerConnectionIceNegotiationNeededEvent=function(a){console.debug("WebRtcCommCall:processRtcPeerConnectionIceNegotationNeeded():event="+a);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionIceNegotationNeeded(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionIceNegotationNeeded(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionIceNegotationNeeded(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionIceNegotationNeeded(): this.peerConnectionState="+this.peerConnectionState)}else{console.warn("WebRtcCommCall:processRtcPeerConnectionIceNegotationNeeded(): event ignored")}};WebRtcCommCall.prototype.onRtcPeerConnectionGatheringChangeEvent=function(b){console.debug("WebRtcCommCall:processRtcPeerConnectionGatheringChange():event="+b);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionGatheringChange(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionGatheringChange(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionGatheringChange(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionGatheringChange(): this.peerConnectionState="+this.peerConnectionState);if(this.peerConnection.signalingState!="closed"){if(this.peerConnection.iceGatheringState=="complete"){if(window.webkitRTCPeerConnection){if(this.peerConnectionState=="preparing-offer"){this.connector.invite(this.peerConnection.localDescription.sdp);this.peerConnectionState="offer-sent"}else{if(this.peerConnectionState=="preparing-answer"){this.connector.accept(this.peerConnection.localDescription.sdp);this.peerConnectionState="established";if(this.webRtcCommClient.eventListener.onWebRtcCommCallOpenedEvent){var a=this;setTimeout(function(){try{a.webRtcCommClient.eventListener.onWebRtcCommCallOpenedEvent(a)}catch(c){console.error("WebRtcCommCall:processRtcPeerConnectionGatheringChange(): catched exception in listener:"+c)}},1)}}else{if(this.peerConnectionState=="established"){}else{console.error("WebRtcCommCall:processRtcPeerConnectionGatheringChange(): RTCPeerConnection bad state!")}}}}}}else{console.error("WebRtcCommCall:processRtcPeerConnectionGatheringChange(): RTCPeerConnection closed!")}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionGatheringChange(): event ignored")}};WebRtcCommCall.prototype.onRtcPeerConnectionIceChangeEvent=function(a){console.debug("WebRtcCommCall:processRtcPeerConnectionIceChange():event="+a);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionIceChange(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionIceChange(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionIceChange(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionIceChange(): this.peerConnectionState="+this.peerConnectionState)}else{console.warn("WebRtcCommCall:processRtcPeerConnectionIceChange(): event ignored")}};WebRtcCommCall.prototype.onRtcPeerConnectionIdentityResultEvent=function(a){console.debug("WebRtcCommCall:processRtcPeerConnectionIdentityResult():event="+a);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionIdentityResult(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionIdentityResult(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionIdentityResult(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionIdentityResult(): this.peerConnectionState="+this.peerConnectionState)}else{console.warn("WebRtcCommCall:processRtcPeerConnectionIdentityResult(): event ignored")}};WebRtcCommCall.prototype.onRtcPeerConnectionOnMessageChannelEvent=function(b){console.debug("WebRtcCommCall:onRtcPeerConnectionOnMessageChannelEvent():event="+JSON.stringify(b));if(this.peerConnection){console.debug("WebRtcCommCall:onRtcPeerConnectionOnMessageChannelEvent(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:onRtcPeerConnectionOnMessageChannelEvent(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:onRtcPeerConnectionOnMessageChannelEvent(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:onRtcPeerConnectionOnMessageChannelEvent(): this.peerConnectionState="+this.peerConnectionState);this.messageChannel=b.channel;console.debug("WebRtcCommCall:onRtcPeerConnectionOnMessageChannelEvent(): this.messageChannel.label="+this.messageChannel.label);console.debug("WebRtcCommCall:onRtcPeerConnectionOnMessageChannelEvent(): this.messageChannel.reliable="+this.messageChannel.reliable);console.debug("WebRtcCommCall:onRtcPeerConnectionOnMessageChannelEvent(): this.messageChannel.binaryType="+this.messageChannel.binaryType);var a=this;this.messageChannel.onopen=function(c){a.processRtcPeerConnectionMessageChannelOnOpen(c)};this.messageChannel.onclose=function(c){a.processRtcPeerConnectionMessageChannelOnClose(c)};this.messageChannel.onerror=function(c){a.processRtcPeerConnectionMessageChannelOnError(c)};this.messageChannel.onmessage=function(c){a.processRtcPeerConnectionMessageChannelOnMessage(c)}}else{console.warn("WebRtcCommCall:onRtcPeerConnectionOnMessageChannelEvent(): event ignored")}};WebRtcCommCall.prototype.processRtcPeerConnectionMessageChannelOnOpen=function(a){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnOpen():event="+a);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnOpen(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnOpen(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnOpen(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnOpen(): this.peerConnectionState="+this.peerConnectionState);if(this.messageChannel){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.messageChannel.readyState="+this.messageChannel.readyState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.messageChannel.binaryType="+this.messageChannel.bufferedAmmount)}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnOpen(): event ignored")}};WebRtcCommCall.prototype.processRtcPeerConnectionMessageChannelOnClose=function(a){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnClose():event="+a);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnClose(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnClose(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnClose(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnClose(): this.peerConnectionState="+this.peerConnectionState);if(this.messageChannel){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.messageChannel.readyState="+this.messageChannel.readyState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.messageChannel.binaryType="+this.messageChannel.bufferedAmmount)}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnClose(): event ignored")}};WebRtcCommCall.prototype.processRtcPeerConnectionMessageChannelOnError=function(a){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnError():event="+a);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnError(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnError(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnError(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnError(): this.peerConnectionState="+this.peerConnectionState);if(this.messageChannel){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnError(): this.messageChannel.readyState="+this.messageChannel.readyState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnError(): this.messageChannel.binaryType="+this.messageChannel.bufferedAmmount)}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnClose(): event ignored")}};WebRtcCommCall.prototype.processRtcPeerConnectionMessageChannelOnMessage=function(b){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage():event="+b);if(this.peerConnection){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.peerConnection.signalingState="+this.peerConnection.signalingState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.peerConnection.iceGatheringState="+this.peerConnection.iceGatheringState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.peerConnection.iceConnectionState="+this.peerConnection.iceConnectionState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.peerConnectionState="+this.peerConnectionState);if(this.messageChannel){console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.messageChannel.readyState="+this.messageChannel.readyState);console.debug("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): this.messageChannel.binaryType="+this.messageChannel.bufferedAmmount);if(this.webRtcCommClient.eventListener.onWebRtcCommCallMessageEvent){var a=this;setTimeout(function(){try{a.webRtcCommClient.eventListener.onWebRtcCommCallMessageEvent(a,b.data)}catch(c){console.error("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): catched exception in listener:"+c)}},1)}}}else{console.warn("WebRtcCommCall:processRtcPeerConnectionMessageChannelOnMessage(): event ignored")}};WebRtcCommCall.prototype.applyConfiguredCodecFilterOnSessionDescription=function(f){if(f instanceof SessionDescription){try{console.debug("WebRtcCommCall:applyConfiguredCodecFilterOnSessionDescription(): sessionDescription="+f);var g=f.getMediaDescriptions(false);for(var e=0;e<g.length;e++){var a=g[e];var h=a.getMedia();var l=h.getType();if(l=="audio"&&this.configuration.audioCodecsFilter){var k=this.getOfferedCodecsInMediaDescription(a);var j=(this.configuration.audioCodecsFilter).split(",");this.applyCodecFiltersOnOfferedCodecs(k,j);this.updateMediaDescription(a,k,j)}else{if(l=="video"&&this.configuration.videoCodecsFilter){var b=this.getOfferedCodecsInMediaDescription(a);var d=(this.configuration.videoCodecsFilter).split(",");this.applyCodecFiltersOnOfferedCodecs(b,d);this.updateMediaDescription(a,b,d)}}}}catch(c){console.error("WebRtcCommCall:applyConfiguredCodecFilterOnSessionDescription(): catched exception, exception:"+c);throw c}}else{throw"WebRtcCommCall:applyConfiguredCodecFilterOnSessionDescription(): bad arguments"}};WebRtcCommCall.prototype.getOfferedCodecsInMediaDescription=function(a){console.debug("WebRtcCommCall:getOfferedCodecsInMediaDescription()");if(a instanceof MediaDescription){var i=a.getMedia().getFormats(false);var f={};for(var h=0;h<i.length;h++){var o=i[h];console.debug("WebRtcCommCall:getOfferedCodecsInMediaDescription(): payloadType="+o);console.debug("WebRtcCommCall:getOfferedCodecsInMediaDescription(): this.codecNames[payloadType]="+this.codecNames[o]);f[o]=this.codecNames[o]}var e=a.getAttributes();for(var g=0;g<e.length;g++){var l=e[g];console.debug("WebRtcCommCall:getOfferedCodecsInMediaDescription(): attributField.getName()="+l.getName());if(l.getName()=="rtpmap"){try{var d=l.getValue();var n=d.split(" ");var o=n[0];var b=n[1];var m=b.split("/");var p=m[0];f[o]=p.toUpperCase();console.debug("WebRtcCommCall:getOfferedCodecsInMediaDescription(): payloadType="+o);console.debug("WebRtcCommCall:getOfferedCodecsInMediaDescription(): codecName="+p)}catch(c){console.error("WebRtcCommCall:getOfferedCodecsInMediaDescription(): rtpmap/fmtp format not supported")}}}return f}else{throw"WebRtcCommCall:getOfferedCodecsInMediaDescription(): bad arguments"}};WebRtcCommCall.prototype.applyCodecFiltersOnOfferedCodecs=function(e,d){console.debug("WebRtcCommCall:applyCodecFiltersOnOfferedCodecs()");if(typeof(e)=="object"&&d instanceof Array){for(var b in e){var a=false;for(var c=0;c<d.length;c++){if(e[b]==d[c]){a=true;break}}if(a==false){delete (e[b])}}}else{throw"WebRtcCommCall:applyCodecFiltersOnOfferedCodecs(): bad arguments"}};WebRtcCommCall.prototype.updateMediaDescription=function(a,n,h){console.debug("WebRtcCommCall:updateMediaDescription()");if(a instanceof MediaDescription&&typeof(n)=="object"&&h instanceof Array){var f=new Array();for(var l=0;l<h.length;l++){for(var j in n){if(n[j]==h[l]){f.push(j);break}}}a.getMedia().setFormats(f);var b=new Array();var e=a.getAttributes();for(var g=0;g<e.length;g++){var m=e[g];console.debug("WebRtcCommCall:updateMediaDescription(): attributField.getName()="+m.getName());if(m.getName()=="rtpmap"||m.getName()=="fmtp"){try{var d=m.getValue();var p=d.split(" ");var o=p[0];if(n[o]!=undefined){b.push(m)}}catch(c){console.error("WebRtcCommCall:updateMediaDescription(): rtpmap/fmtp format not supported")}}else{b.push(m)}}a.setAttributes(b)}else{throw"WebRtcCommCall:updateMediaDescription(): bad arguments"}};WebRtcCommCall.prototype.removeMediaDescription=function(f,h){console.debug("WebRtcCommCall:removeMediaDescription()");if(f instanceof SessionDescription){try{var e=f.getMediaDescriptions(false);for(var d=0;d<e.length;d++){var c=e[d];var g=c.getMedia();var a=g.getType();if(a==h){e.remove(d);break}}}catch(b){console.error("WebRtcCommCall:removeMediaDescription(): catched exception, exception:"+b);throw b}}else{throw"WebRtcCommCall:removeMediaDescription(): bad arguments"}};WebRtcCommClient=function(a){if(typeof a=="object"){this.id="WebRtcCommClient"+Math.floor(Math.random()*2147483648);console.debug("WebRtcCommClient:WebRtcCommClient():this.id="+this.id);this.eventListener=a;this.configuration=undefined;this.connector=undefined;this.closePendingFlag=false}else{throw"WebRtcCommClient:WebRtcCommClient(): bad arguments"}};WebRtcCommClient.prototype.SIP="SIP";WebRtcCommClient.prototype.isOpened=function(){if(this.connector){return this.connector.isOpened()}else{return false}};WebRtcCommClient.prototype.getConfiguration=function(){return this.configuration};WebRtcCommClient.prototype.open=function(a){console.debug("WebRtcCommClient:open(): configuration="+JSON.stringify(a));if(typeof(a)=="object"){if(this.isOpened()==false){if(this.checkConfiguration(a)==true){this.configuration=a;if(a.communicationMode==WebRtcCommClient.prototype.SIP){this.connector=new PrivateJainSipClientConnector(this);this.connector.open(this.configuration.sip)}}else{console.error("WebRtcCommClient:open(): bad configuration");throw"WebRtcCommClient:open(): bad configuration"}}else{console.error("WebRtcCommClient:open(): bad state, unauthorized action");throw"WebRtcCommClient:open(): bad state, unauthorized action"}}else{console.error("WebRtcCommClient:open(): bad argument, check API documentation");throw"WebRtcCommClient:open(): bad argument, check API documentation"}};WebRtcCommClient.prototype.close=function(){console.debug("WebRtcCommClient:close()");if(this.isOpened()){try{this.closePendingFlag=true;this.connector.close()}catch(a){console.error("WebRtcCommClient:close(): catched exception:"+a);this.closePendingFlag=false;this.connector=undefined;if(this.eventListener.onWebRtcCommClientClosedEvent!=undefined){var b=this;setTimeout(function(){try{b.eventListener.onWebRtcCommClientClosedEvent(b)}catch(c){console.error("WebRtcCommClient:onWebRtcCommClientClosed(): catched exception in event listener:"+c)}},1)}}}};WebRtcCommClient.prototype.call=function(c,d){console.debug("WebRtcCommClient:call():calleePhoneNumber="+c);console.debug("WebRtcCommClient:call():callConfiguration="+JSON.stringify(d));try{if(typeof(c)=="string"&&typeof(d)=="object"){if(this.isOpened()){var a=new WebRtcCommCall(this);a.connector=this.connector.createPrivateCallConnector(a);a.id=a.connector.getId();a.open(c,d);return a}else{console.error("WebRtcCommClient:call(): bad state, unauthorized action");throw"WebRtcCommClient:call(): bad state, unauthorized action"}}else{console.error("WebRtcCommClient:call(): bad argument, check API documentation");throw"WebRtcCommClient:call(): bad argument, check API documentation"}}catch(b){console.error("WebRtcCommClient:call(): catched exception:"+b);throw b}};WebRtcCommClient.prototype.checkConfiguration=function(b){console.debug("WebRtcCommClient:checkConfiguration(): configuration="+JSON.stringify(b));var a=true;if(b.communicationMode!=undefined){if(b.communicationMode==WebRtcCommClient.prototype.SIP){}else{a=false;console.error("WebRtcCommClient:checkConfiguration(): unsupported communicationMode")}}else{a=false;console.error("WebRtcCommClient:checkConfiguration(): missing configuration parameter communicationMode")}return a};WebRtcCommClient.prototype.onPrivateClientConnectorOpenedEvent=function(){console.debug("WebRtcCommClient:onPrivateClientConnectorOpenedEvent()");if(this.eventListener.onWebRtcCommClientOpenedEvent!=undefined){var a=this;setTimeout(function(){try{a.eventListener.onWebRtcCommClientOpenedEvent()}catch(b){console.error("WebRtcCommClient:onPrivateClientConnectorOpenedEvent(): catched exception in event listener:"+b)}},1)}};WebRtcCommClient.prototype.onPrivateClientConnectorOpenErrorEvent=function(a){console.debug("WebRtcCommClient:onPrivateClientConnectorOpenErrorEvent():error:"+a);try{this.close()}catch(b){}if(this.eventListener.onWebRtcCommClientOpenErrorEvent!=undefined){var c=this;setTimeout(function(){try{c.eventListener.onWebRtcCommClientOpenErrorEvent(a)}catch(d){console.error("WebRtcCommClient:onPrivateClientConnectorOpenErrorEvent(): catched exception in event listener:"+d)}},1)}};WebRtcCommClient.prototype.onPrivateClientConnectorClosedEvent=function(){console.debug("WebRtcCommClient:onPrivateClientConnectorClosedEvent()");var c=this.isOpened()||this.closePendingFlag;try{if(this.closePendingFlag==false){this.close()}else{this.connector=undefined}}catch(a){}if(c&&this.eventListener.onWebRtcCommClientClosedEvent!=undefined){var b=this;setTimeout(function(){try{b.eventListener.onWebRtcCommClientClosedEvent()}catch(d){console.error("WebRtcCommClient:onPrivateClientConnectorClosedEvent(): catched exception in event listener:"+d)}},1)}else{if(!c&&this.eventListener.onWebRtcCommClientOpenErrorEvent!=undefined){var b=this;setTimeout(function(){try{b.eventListener.onWebRtcCommClientOpenErrorEvent("Connection to WebRtcCommServer has failed")}catch(d){console.error("WebRtcCommClient:onWebRtcCommClientOpenErrorEvent(): catched exception in event listener:"+d)}},1)}}};WebRtcCommClientEventListenerInterface=function(){};WebRtcCommClientEventListenerInterface.prototype.onWebRtcCommClientOpenedEvent=function(){throw"WebRtcCommClientEventListenerInterface:onWebRtcCommClientOpenedEvent(): not implemented;"};WebRtcCommClientEventListenerInterface.prototype.onWebRtcCommClientOpenErrorEvent=function(a){throw"WebRtcCommClientEventListenerInterface:onWebRtcCommClientOpenErrorEvent(): not implemented;"};WebRtcCommClientEventListenerInterface.prototype.onWebRtcCommClientClosedEvent=function(a){throw"WebRtcCommClientEventListenerInterface:onWebRtcCommClientClosedEvent(): not implemented;"};WebRtcCommCallEventListenerInterface=function(){};WebRtcCommCallEventListenerInterface.prototype.onWebRtcCommCallOpenedEvent=function(a){throw"WebRtcCommCallEventListenerInterface:onWebRtcCommCallOpenedEvent(): not implemented;"};WebRtcCommCallEventListenerInterface.prototype.onWebRtcCommCallInProgressEvent=function(a){throw"WebRtcCommCallEventListenerInterface:onWebRtcCommCallInProgressEvent(): not implemented;"};WebRtcCommCallEventListenerInterface.prototype.onWebRtcCommCallOpenErrorEvent=function(b,a){throw"WebRtcCommCallEventListenerInterface:onWebRtcCommCallOpenErrorEvent(): not implemented;"};WebRtcCommCallEventListenerInterface.prototype.onWebRtcCommCallRingingEvent=function(a){throw"WebRtcCommCallEventListenerInterface:onWebRtcCommCallRingingEvent(): not implemented;"};WebRtcCommCallEventListenerInterface.prototype.onWebRtcCommCallRingingBackEvent=function(a){throw"WebRtcCommCallEventListenerInterface:onWebRtcCommCallRingingBackEvent(): not implemented;"};WebRtcCommCallEventListenerInterface.prototype.onWebRtcCommCallHangupEvent=function(a){throw"WebRtcCommCallEventListenerInterface:onWebRtcCommCallHangupEvent(): not implemented;"};WebRtcCommCallEventListenerInterface.prototype.onWebRtcCommCallMessageEvent=function(b,a){throw"WebRtcCommCallEventListenerInterface:onWebRtcCommCallMessageEvent(): not implemented;"};